<!DOCTYPE html>
<html lang="en">
  
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <!-- Plotly for charts -->
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <!-- D3 for CSV loading -->
  <script src="https://d3js.org/d3.v7.min.js"></script>

  <style>
    /* --- Global --- */
    * {
      box-sizing: border-box;
    }
    
    body {
      margin: 0;
      font-family: "Inter", -apple-system, BlinkMacSystemFont, sans-serif;
      background: linear-gradient(135deg, #0f1419 0%, #1a1f2e 100%);
      color: #e0e0e0;
      overflow-x: hidden;
    }

    /* --- Animated Title Section --- */
    .title-section {
      text-align: center;
      margin: 40px 0 20px 0;
      position: relative;
      height: 80px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .title-container {
      position: relative;
      overflow: hidden;
      height: 80px;
      width: 100%;
      max-width: 1200px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .title-slider {
      position: relative;
      white-space: nowrap;
      font-size: clamp(2rem, 4vw, 3rem);
      font-weight: 600;
      background: linear-gradient(45deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
      background-size: 200% 200%;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      animation: gradientShift 6s ease-in-out infinite alternate;
      letter-spacing: 0.05em;
      text-transform: uppercase;
      text-align: center;
    }

    @keyframes gradientShift {
      0% { background-position: 0% 50%; }
      100% { background-position: 100% 50%; }
    }

    .title-glow {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 300px;
      height: 300px;
      background: radial-gradient(circle, rgba(102, 126, 234, 0.3) 0%, transparent 70%);
      border-radius: 50%;
      animation: pulse 4s ease-in-out infinite;
      pointer-events: none;
    }

    @keyframes pulse {
      0%, 100% { transform: translate(-50%, -50%) scale(0.8); opacity: 0.5; }
      50% { transform: translate(-50%, -50%) scale(1.2); opacity: 0.8; }
    }

    /* --- Filters --- */
    #filters {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-bottom: 30px;
      flex-wrap: wrap;
    }

    #filters button {
      background: rgba(255, 255, 255, 0.05);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      padding: 12px 28px;
      border-radius: 50px;
      color: #f0f0f0;
      cursor: pointer;
      font-size: 16px;
      font-weight: 500;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }
    
    #filters button::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
      transition: left 0.5s;
    }
    
    #filters button:hover::before {
      left: 100%;
    }
    
    #filters button:hover, #filters button.active {
      background: rgba(102, 126, 234, 0.2);
      border-color: rgba(102, 126, 234, 0.5);
      transform: translateY(-2px);
      box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
    }

    /* --- Charts Container --- */
    #charts-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(380px, 1fr));
      gap: 30px;
      padding: 0 20px;
      max-width: 1400px;
      margin: 0 auto;
    }

    @media (max-width: 768px) {
      #charts-container {
        grid-template-columns: 1fr;
        gap: 20px;
        padding: 0 10px;
      }
    }

    /* --- Chart Cards --- */
    .chart-card {
      background: rgba(255, 255, 255, 0.02);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 20px;
      overflow: hidden;
      transition: all 0.4s ease;
      position: relative;
      min-height: 400px;
    }

    .chart-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 1px;
      background: linear-gradient(90deg, transparent, rgba(102, 126, 234, 0.5), transparent);
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .chart-card:hover {
      transform: translateY(-8px);
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
      border-color: rgba(102, 126, 234, 0.3);
    }

    .chart-card:hover::before {
      opacity: 1;
    }

    .chart-title {
      padding: 20px 20px 15px 20px;
      font-weight: 600;
      font-size: 18px;
      color: #ffffff;
      text-align: center;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      margin-bottom: 0;
      background: rgba(255, 255, 255, 0.02);
    }

    /* --- Chart Box (Plotly container) --- */
    .chart-box {
      width: 100%;
      height: 320px;
      padding: 10px;
    }

    /* --- Sheep Container --- */
    #sheep-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      overflow: hidden;
      z-index: 9999;
    }

    .sheep {
      position: absolute;
      font-size: 2rem;
      user-select: none;
      transform: translate(0,0);
      pointer-events: auto;
      cursor: pointer;
      transition: transform 0.1s ease;
    }

    .sheep:hover {
      transform: scale(1.2);
    }

    /* --- Sheep Controls --- */
    .sheep-controls {
      position: fixed;
      top: 20px;
      right: 20px;
      display: flex;
      align-items: center;
      gap: 15px;
      z-index: 10000;
    }

    .sheep-counter {
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      padding: 8px 16px;
      border-radius: 20px;
      color: #f0f0f0;
      font-size: 14px;
      font-weight: 500;
      opacity: 0.8;
      transition: opacity 0.3s ease;
    }

    .sheep-counter:hover {
      opacity: 1;
    }

    .wipe-sheep-btn {
      background: rgba(239, 86, 117, 0.2);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(239, 86, 117, 0.3);
      padding: 8px 16px;
      border-radius: 20px;
      color: #f0f0f0;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      transition: all 0.3s ease;
      opacity: 0.8;
    }

    .wipe-sheep-btn:hover {
      background: rgba(239, 86, 117, 0.4);
      border-color: rgba(239, 86, 117, 0.6);
      opacity: 1;
      transform: translateY(-1px);
    }

    /* --- Scrollbar --- */
    ::-webkit-scrollbar {
      width: 8px;
    }
    ::-webkit-scrollbar-thumb {
      background: linear-gradient(45deg, #667eea, #764ba2);
      border-radius: 4px;
    }
    ::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, 0.05);
    }

    /* Chart title categories with better icons and colors */
    .chart-card[data-category="deep"] .chart-title {
      color: #1f3b4d;
    }
    .chart-card[data-category="light"] .chart-title {
      color: #7a5195;
    }
    .chart-card[data-category="rem"] .chart-title {
      color: #ef5675;
    }
    .chart-card[data-category="awake"] .chart-title {
      color: #ffa600;
    }
    .chart-card[data-category="total"] .chart-title {
      color: #2ca02c;
    }
    .chart-card[data-category="health"] .chart-title {
      color: #f093fb;
    }

  </style>

  <script>
    // Enhanced title animation
    document.addEventListener('DOMContentLoaded', function() {
      const titleText = "SLEEP ANALYTICS DASHBOARD";
      let currentIndex = 0;
      
      function updateTitle() {
        const shifted = titleText.substring(currentIndex) + " • " + titleText.substring(0, currentIndex);
        document.title = shifted;
        currentIndex = (currentIndex + 1) % titleText.length;
      }
      
      setInterval(updateTitle, 400);
    });
  </script>

  <script>
    (() => {
      let clickCount = 0;
      let totalSheep = 0;
      const clickLimit = 5;
      
      document.addEventListener('DOMContentLoaded', function() {
        const container = document.getElementById("sheep-container");
        const counter = document.getElementById("sheep-counter");
        const wipeBtn = document.getElementById("wipe-sheep-btn");

        if (!container) return;

        function updateCounter() {
          if (counter) {
            counter.textContent = `🐑 ${clickCount}/${totalSheep}`;
          }
        }

        function wipeAllSheep() {
          // Remove all sheep
          const allSheep = container.querySelectorAll('.sheep');
          allSheep.forEach(sheep => sheep.remove());
          
          // Reset counters
          clickCount = 0;
          totalSheep = 0;
          updateCounter();
          
          // Respawn initial sheep
          for (let i = 0; i < 5; i++) {
            spawnFloatingSheep();
          }
        }

        // Add event listener for wipe button
        if (wipeBtn) {
          wipeBtn.addEventListener('click', wipeAllSheep);
        }

        // --- floating sheep ---
        function spawnFloatingSheep() {
          const sheep = document.createElement("div");
          sheep.classList.add("sheep");
          sheep.textContent = "🐑";
          container.appendChild(sheep);
          totalSheep++;
          updateCounter();

          let x = Math.random() * (window.innerWidth - 50);
          let y = Math.random() * (window.innerHeight - 50);
          let dx = (Math.random() - 0.5) * 3;
          let dy = (Math.random() - 0.5) * 3;

          sheep.style.position = "absolute";
          sheep.style.left = x + "px";
          sheep.style.top = y + "px";

          function move() {
            x += dx;
            y += dy;

            if (x < 0 || x > window.innerWidth - 30) dx *= -1;
            if (y < 0 || y > window.innerHeight - 30) dy *= -1;

            sheep.style.left = x + "px";
            sheep.style.top = y + "px";

            requestAnimationFrame(move);
          }
          move();

          sheep.addEventListener("click", () => {
            clickCount++;
            sheep.remove();
            totalSheep--;
            updateCounter();

            if (clickCount >= clickLimit) {
              startSheepExplosion();
            }
          });
        }

        // Spawn initial floating sheep
        for (let i = 0; i < 5; i++) spawnFloatingSheep();

        // --- roaming sheep after explosion ---
        function spawnRoamingSheep() {
          const sheep = document.createElement("div");
          sheep.classList.add("sheep");
          sheep.textContent = "🐑";
          container.appendChild(sheep);
          totalSheep++;
          updateCounter();

          let x = -50;
          let y = Math.random() * (window.innerHeight - 50);
          const speed = 1 + Math.random() * 3;

          function move() {
            x += speed;
            const bounce = Math.sin(x / 50) * 20;
            sheep.style.transform = `translate(${x}px, ${y + bounce}px)`;
            if (x < window.innerWidth + 50) {
              requestAnimationFrame(move);
            } else {
              sheep.remove();
              totalSheep--;
              updateCounter();
            }
          }
          move();
        }

        function startSheepExplosion() {
          for (let i = 0; i < 10; i++) spawnRoamingSheep();
          setInterval(spawnRoamingSheep, 300);
        }
      });
    })();
  </script>
</head>

<body>
  <div class="title-section">
    <div class="title-glow"></div>
    <div class="title-container">
      <div class="title-slider">🌙 SLEEP ANALYTICS DASHBOARD 💤</div>
    </div>
  </div>

  <div class="sheep-controls">
    <div id="sheep-counter" class="sheep-counter">🐑 0/5</div>
    <button id="wipe-sheep-btn" class="wipe-sheep-btn">Clear All 🧹</button>
  </div>

  <div id="sheep-container"></div>

  <div id="filters">
    <button data-range="7" class="active">Last 7 Days</button>
    <button data-range="30">Last Month</button>
    <button data-range="365">Last Year</button>
  </div>

  <div id="charts-container">
    <div class="chart-card" data-category="deep">
      <div class="chart-title">🛌 Deep Sleep</div>
      <div id="deep-chart" class="chart-box"></div>
    </div>
    <div class="chart-card" data-category="light">
      <div class="chart-title">🌙 Light Sleep</div>
      <div id="light-chart" class="chart-box"></div>
    </div>
    <div class="chart-card" data-category="rem">
      <div class="chart-title">🌸 REM Sleep</div>
      <div id="rem-chart" class="chart-box"></div>
    </div>
    <div class="chart-card" data-category="awake">
      <div class="chart-title">⏰ Twisting & Turning</div>
      <div id="awake-chart" class="chart-box"></div>
    </div>
    <div class="chart-card" data-category="total">
      <div class="chart-title">⏱️ Total Sleep</div>
      <div id="total-chart" class="chart-box"></div>
    </div>
    <div class="chart-card" data-category="health">
      <div class="chart-title">🫁 Oxygen Saturation</div>
      <div id="spo2-chart" class="chart-box"></div>
    </div>
    <div class="chart-card" data-category="health">
      <div class="chart-title">💖 Average Heart Rate</div>
      <div id="hr-chart" class="chart-box"></div>
    </div>
    <div class="chart-card" data-category="health">
      <div class="chart-title">🌬️ Respiration Rate</div>
      <div id="resp-chart" class="chart-box"></div>
    </div>
    <div class="chart-card" data-category="health">
      <div class="chart-title">⭐ Sleep Quality Scores</div>
      <div id="sleep-scores-chart" class="chart-box"></div>
    </div>
  </div>

  <script>
    // Generate sample data since we don't have access to the CSV file
    function generateSampleData() {
      const data = [];
      const today = new Date();
      for (let i = 365; i >= 0; i--) {
        const date = new Date(today);
        date.setDate(today.getDate() - i);
        
        data.push({
          date: date,
          deep: 1.2 + Math.random() * 1.5,
          light: 2.8 + Math.random() * 2,
          rem: 1.6 + Math.random() * 1,
          awake: Math.random() * 0.5,
          total: 7 + Math.random() * 2,
          spo2_avg: 95 + Math.random() * 4,
          spo2_low: 90 + Math.random() * 5,
          avgHR: 60 + Math.random() * 20,
          resp_avg: 15 + Math.random() * 5,
          resp_low: 12 + Math.random() * 3,
          resp_high: 18 + Math.random() * 7,
          score_overall: 70 + Math.random() * 30,
          score_quality: 70 + Math.random() * 30,
          score_duration: 70 + Math.random() * 30,
          score_recovery: 70 + Math.random() * 30,
          score_restfulness: 70 + Math.random() * 30,
          score_interruptions: 70 + Math.random() * 30
        });
      }
      return data;
    }

    const stages = [
      { key: "deep", label: "Deep Sleep", recommendedMin: 1.2, recommendedMax: 2, color:"#1f3b4d", div:"deep-chart" },
      { key: "light", label: "Light Sleep", recommendedMin: 2.8, recommendedMax: 4, color:"#7a5195", div:"light-chart" },
      { key: "rem", label: "REM Sleep", recommendedMin: 1.6, recommendedMax: 2, color:"#ef5675", div:"rem-chart" },
      { key: "awake", label: "Awake", recommendedMin: 0, recommendedMax: 0.5, color:"#ffa600", div:"awake-chart" },
      { key: "total", label: "Total Sleep", recommendedMin: 7.5, recommendedMax: 8.5, color:"#2ca02c", div:"total-chart" }
    ];

    let rawDataGlobal = generateSampleData();
    let filteredMaxTotal = Math.max(...rawDataGlobal.map(d => d.total)) * 1.05;

    function renderExtraCharts(filteredData) {
      // SPO2 Oxygen Chart
      Plotly.newPlot("spo2-chart", [
        {
          x: filteredData.map(d=>d.date),
          y: filteredData.map(d=>d.spo2_avg),
          name: "Avg SPO₂",
          mode: "lines+markers",
          line: { color: "#38a169", width: 3, shape: "spline" },
          marker: { size: 6 },
          hovertemplate: "%{y:.1f}%<br>%{x|%a %d %b}<extra></extra>"
        },
        {
          x: filteredData.map(d=>d.date),
          y: filteredData.map(d=>d.spo2_low),
          name: "Lowest SPO₂",
          mode: "lines+markers",
          line: { color: "#e53e3e", width: 2, dash: "dot", shape: "spline" },
          marker: { size: 4 },
          hovertemplate: "Low: %{y:.1f}%<br>%{x|%a %d %b}<extra></extra>"
        }
      ], {
        height: 320,
        margin: { l: 60, r: 30, t: 10, b: 60 },
        paper_bgcolor: "transparent",
        plot_bgcolor: "transparent",
        xaxis: {
          tickformat: "%d %b", 
          color: "#f0f0f0",
          showgrid: true,
          gridcolor: "rgba(255,255,255,0.1)",
          tickangle: -45
        },
        yaxis: { 
          title: "", 
          color: "#f0f0f0", 
          gridcolor: "rgba(255,255,255,0.1)", 
          range: [85, 100] 
        },
        legend: { 
          font: { color: "#f0f0f0" },
          orientation: "h",
          y: -0.3
        }
      }, {responsive: true});

      // Heart Rate
      Plotly.newPlot("hr-chart", [{
        x: filteredData.map(d=>d.date),
        y: filteredData.map(d=>d.avgHR),
        mode: "lines+markers",
        line: { color: "#7a5195", width: 3, shape: "spline" },
        marker: { size: 6 },
        hovertemplate: "%{y:.0f} bpm<br>%{x|%a %d %b}<extra></extra>"
      }], {
        height: 320,
        margin: { l: 60, r: 30, t: 10, b: 60 },
        paper_bgcolor: "transparent",
        plot_bgcolor: "transparent",
        xaxis: {
          tickformat: "%d %b", 
          color: "#f0f0f0",
          showgrid: true,
          gridcolor: "rgba(255,255,255,0.1)",
          tickangle: -45
        },
        yaxis: { 
          color: "#f0f0f0", 
          gridcolor: "rgba(255,255,255,0.1)" 
        }
      }, {responsive: true});

      // Respiration
      Plotly.newPlot("resp-chart", [
        {
          x: filteredData.map(d=>d.date),
          y: filteredData.map(d=>d.resp_avg),
          name: "Average",
          mode: "lines+markers",
          line: { color: "#1f77b4", width: 3, shape: "spline" },
          marker: { size: 6 },
          hovertemplate: "Avg %{y:.1f}<br>%{x|%a %d %b}<extra></extra>"
        },
        {
          x: filteredData.map(d=>d.date),
          y: filteredData.map(d=>d.resp_low),
          name: "Lowest",
          mode: "lines+markers",
          line: { color: "#2ca02c", width: 2, dash: "dot", shape: "spline"},
          marker: { size: 4 },
          hovertemplate: "Low %{y:.1f}<br>%{x|%a %d %b}<extra></extra>"
        },
        {
          x: filteredData.map(d=>d.date),
          y: filteredData.map(d=>d.resp_high),
          name: "Highest",
          mode: "lines+markers",
          line: { color: "#ef5675", width: 2, dash: "dot", shape: "spline"},
          marker: { size: 4 },
          hovertemplate: "High %{y:.1f}<br>%{x|%a %d %b}<extra></extra>"
        }
      ], {
        height: 320,
        margin: { l: 60, r: 30, t: 10, b: 60 },
        paper_bgcolor: "transparent",
        plot_bgcolor: "transparent",
        xaxis: {
          tickformat: "%d %b", 
          color: "#f0f0f0",
          showgrid: true,
          gridcolor: "rgba(255,255,255,0.1)",
          tickangle: -45
        },
        yaxis: { 
          title: "", 
          color: "#f0f0f0", 
          gridcolor: "rgba(255,255,255,0.1)", 
          range: [10, 30] 
        },
        legend: { 
          font: { color: "#f0f0f0" },
          orientation: "h",
          y: -0.3
        }
      }, {responsive: true});
    }

    function renderSleepScoresChart(data) {
      const traces = [
        {
          x: data.map(d => d.date),
          y: data.map(d => d.score_overall),
          name: "Overall",
          mode: "lines+markers",
          line: { color: "#1f77b4", width: 3, shape: "spline" },
          marker: { size: 6 },
          hovertemplate: "Overall %{y:.0f}<br>%{x|%a %d %b}<extra></extra>"
        },
        {
          x: data.map(d => d.date),
          y: data.map(d => d.score_quality),
          name: "Quality",
          mode: "lines",
          line: { color: "#ff7f0e", width: 2, dash: "dot", shape: "spline" },
          hovertemplate: "Quality %{y:.0f}<br>%{x|%a %d %b}<extra></extra>"
        },
        {
          x: data.map(d => d.date),
          y: data.map(d => d.score_duration),
          name: "Duration",
          mode: "lines",
          line: { color: "#2ca02c", width: 2, dash: "dot", shape: "spline" },
          hovertemplate: "Duration %{y:.0f}<br>%{x|%a %d %b}<extra></extra>"
        }
      ];

      const layout = {
        height: 320,
        margin: { l: 60, r: 30, t: 10, b: 60 },
        paper_bgcolor: "transparent",
        plot_bgcolor: "transparent",
        xaxis: { 
          tickformat: "%d %b", 
          color: "#f0f0f0", 
          gridcolor: "rgba(255,255,255,0.1)", 
          tickangle: -45
        },
        yaxis: { 
          color: "#f0f0f0", 
          gridcolor: "rgba(255,255,255,0.1)", 
          range: [0, 105]
        },
        legend: { 
          orientation: "h", 
          y: -0.3, 
          font: { color: "#f0f0f0" } 
        }
      };

      Plotly.newPlot("sleep-scores-chart", traces, layout, { responsive: true });
    }

    function renderCharts(days) {
      if (rawDataGlobal.length === 0) return;

      const maxDate = new Date(Math.max(...rawDataGlobal.map(d => d.date)));
      const endDate = new Date(maxDate.getFullYear(), maxDate.getMonth(), maxDate.getDate());
      const startDate = new Date(endDate);
      startDate.setDate(endDate.getDate() - days + 1);

      const filteredData = rawDataGlobal.filter(d => {
        const dDate = new Date(d.date.getFullYear(), d.date.getMonth(), d.date.getDate());
        return dDate >= startDate && dDate <= endDate;
      });

      if(filteredData.length === 0) {
        stages.forEach(stage => {
          document.getElementById(stage.div).innerHTML = "<p style='text-align:center;color:#f0f0f0;margin-top:120px;'>No data for this range</p>";
        });
        return;
      }

      stages.forEach(stage => {
        const trace = {
          x: filteredData.map(d=>d.date),
          y: filteredData.map(d=>d[stage.key]),
          mode: 'lines+markers',
          line: { color: stage.color, width: 3, shape: 'spline' },
          marker: { size: 6 },
          type: 'scatter',
          fill: stage.key !== 'awake' ? 'tonexty' : 'none',
          fillcolor: stage.key !== 'awake' ? stage.color + '33' : 'transparent',
          hovertemplate: '%{y:.2f} hours<br>%{x|%a %d %b}<extra></extra>'
        };

        const traces = [trace];

        // Add recommended range for non-awake stages
        if (stage.recommendedMin > 0) {
          traces.unshift({
            x: [filteredData[0].date, filteredData[filteredData.length-1].date],
            y: [stage.recommendedMin, stage.recommendedMin],
            type: 'scatter',
            mode: 'lines',
            line: { color: stage.color, width: 0 },
            fill: 'tonexty',
            fillcolor: stage.color + '22',
            showlegend: false,
            hoverinfo: 'skip'
          });

          traces.push({
            x: [filteredData[0].date, filteredData[filteredData.length-1].date],
            y: [stage.recommendedMax, stage.recommendedMax],
            type: 'scatter',
            mode: 'lines',
            line: { color: stage.color, width: 0 },
            fill: 'tonexty',
            fillcolor: 'transparent',
            showlegend: false,
            hoverinfo: 'skip'
          });
        }

        Plotly.newPlot(stage.div, traces, {
          height: 320,
          margin: { l: 60, r: 30, t: 10, b: 60 },
          paper_bgcolor: 'transparent',
          plot_bgcolor: 'transparent',
          xaxis: {
            tickformat: '%d %b',
            color: '#f0f0f0',
            showgrid: true,
            gridcolor: 'rgba(255,255,255,0.1)',
            tickangle: -45
          },
          yaxis: {
            range: [0, filteredMaxTotal],
            color: '#f0f0f0',
            showgrid: true,
            gridcolor: 'rgba(255,255,255,0.1)'
          },
          showlegend: false
        }, { responsive: true });
      });

      renderExtraCharts(filteredData);
      renderSleepScoresChart(filteredData);
    }

    // Initialize charts and event listeners
    document.addEventListener('DOMContentLoaded', function() {
      renderCharts(7);
      
      document.querySelectorAll('#filters button').forEach(btn => {
        btn.addEventListener('click', () => {
          document.querySelectorAll('#filters button').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          renderCharts(+btn.dataset.range);
        });
      });
    });
  </script>
</body>
</html>